generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ApplicationStatus {
  SAVED
  APPLIED
  UNDER_REVIEW
  INTERVIEW
  OFFER
  REJECTED
}

enum ApplicationPriority {
  HIGH
  MEDIUM
  LOW
}

enum InterviewType {
  PHONE_SCREEN
  TECHNICAL
  BEHAVIORAL
  ONSITE
  PANEL
  OTHER
}

model Application {
  id            String              @id @default(cuid())
  clerkUserId   String
  title         String
  company       String
  location      String?
  salaryMin     Int?
  salaryMax     Int?
  url           String?
  status        ApplicationStatus   @default(SAVED)
  priority      ApplicationPriority?
  dateApplied   DateTime?
  followUpDate  DateTime?
  coverLetter   String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  notes         Note[]
  statusChanges StatusChange[]
  interviews    Interview[]
  tags          ApplicationTag[]

  @@index([clerkUserId])
}

model Interview {
  id            String        @id @default(cuid())
  applicationId String
  type          InterviewType
  scheduledAt   DateTime
  location      String?
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  application   Application   @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

model Tag {
  id          String           @id @default(cuid())
  clerkUserId String
  name        String
  color       String           @default("#10b981")
  createdAt   DateTime         @default(now())

  applications ApplicationTag[]

  @@unique([clerkUserId, name])
  @@index([clerkUserId])
}

model ApplicationTag {
  applicationId String
  tagId         String

  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  tag           Tag         @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([applicationId, tagId])
}

model Note {
  id            String       @id @default(cuid())
  applicationId String
  content       String
  createdAt     DateTime     @default(now())

  application   Application  @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

model StatusChange {
  id            String              @id @default(cuid())
  applicationId String
  fromStatus    ApplicationStatus
  toStatus      ApplicationStatus
  changedAt     DateTime            @default(now())

  application   Application         @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

model Resume {
  id          String   @id @default(cuid())
  clerkUserId String   @unique
  content     String
  fileName    String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  @@index([clerkUserId])
}
